---
lima_kilo_toolforge_deploy_repo:
  url: https://gitlab.wikimedia.org/repos/cloud/toolforge/toolforge-deploy
  branch: main

lima_kilo_toolforge_deploy_components:
  - name: image-config
    cmd: ./deploy.sh image-config local
  - name: cert-manager
    # use --wait to make sure all resources are up and running before deploying anything else
    # this gets passed to helmfile, which gets passed to helm
    cmd: ./deploy.sh cert-manager local --wait
  - name: volume-admission
    cmd: ./deploy.sh volume-admission local
  - name: jobs-api
    cmd: ./deploy.sh jobs-api local
  - name: envvars-api
    cmd: ./deploy.sh envvars-api local
  - name: builds-builder
    cmd: HARBOR_IP={{ lima_kilo_harbor_ip_for_within_k8s }} ./deploy.sh builds-builder local
  - name: builds-api
    # deploying this depends on builds-builder
    cmd: HARBOR_IP={{ lima_kilo_harbor_ip_for_within_k8s }} ./deploy.sh builds-api local
  - name: builds-admission
    cmd: HARBOR_IP={{ lima_kilo_harbor_ip_for_within_k8s }} ./deploy.sh builds-admission local
  - name: api-gateway
    # use --wait to make sure all resources are up and running before deploying anything else
    # this gets passed to helmfile, which gets passed to helm
    cmd: ./deploy.sh api-gateway local --wait

lima_kilo_k8s_other_custom_components:
  - name: foxtrot-ldap
    git_url: https://gitlab.wikimedia.org/repos/cloud/toolforge/foxtrot-ldap
    build: docker build --tag foxtrot-ldap:latest .
    deploy: ./deploy.sh
